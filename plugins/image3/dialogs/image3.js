/*
 Copyright (c) 2003-2017, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.md or http://ckeditor.com/license
*/
CKEDITOR.dialog.add("image3",function(k){function H(){var a=this.getValue().match(I);(a=!(!a||0===parseInt(a[1],10)))||alert(e["invalid"+CKEDITOR.tools.capitalize(this.id)]);return a}function R(){function a(a,b){c.push(m.once(a,function(a){for(var m;m=c.pop();)m.removeListener();b(a)}))}var m=z.createElement("img"),c=[];return function(c,b,d){a("load",function(){var a=J(m);b.call(d,m,a.width,a.height)});a("error",function(){b(null)});a("abort",function(){b(null)});m.setAttribute("src",(D.baseHref||
"")+c+"?"+Math.random().toString(16).substring(2))}}function K(){var a=this.getValue();A(!1);a!==n.data.src?(L(a,function(a,c,b){A(!0);if(!a)return r(!1);g.setValue(!1===k.config.image3_prefillDimensions?0:c);h.setValue(!1===k.config.image3_prefillDimensions?0:b);t=c;u=b;r(l.checkHasNaturalRatio(a))}),v=!0):v?(A(!0),g.setValue(p),h.setValue(q),v=!1):A(!0)}function M(){if(d){var a=this.getValue();if(a&&(a.match(I)||r(!1),"0"!==a)){var b="width"==this.id,c=p||t,e=q||u,f=w.getValue()==x,c={height:e,
width:c};f&&(c=l.convertDimensionsTo(n,c,x,B()));a=b?Math.round(a/c.width*c.height):Math.round(a/c.height*c.width);isNaN(a)||(b?h:g).setValue(a)}}}function r(a){if(f){if("boolean"==typeof a){if(E)return;d=a}else{a=g.getValue();E=!0;d=!d;var b={width:p,height:q},c=w.getValue();c==x&&(b=l.convertDimensionsTo(n,b,c,B()));d&&a&&(a*=b.height/b.width,isNaN(a)||h.setValue(Math.round(a)))}f[d?"removeClass":"addClass"]("cke_btn_unlocked");f.setAttribute("aria-checked",d);CKEDITOR.env.hc&&f.getChild(0).setHtml(d?
CKEDITOR.env.ie?"■":"▣":CKEDITOR.env.ie?"□":"▢")}}function A(a){a=a?"enable":"disable";g[a]();h[a]()}var I=/(^\s*(\d+)\s*$)|^$/i,N=CKEDITOR.tools.getNextId(),O=CKEDITOR.tools.getNextId(),b=k.lang.image3,e=k.lang.common,S=(new CKEDITOR.template('\x3cdiv\x3e\x3ca href\x3d"javascript:void(0)" tabindex\x3d"-1" title\x3d"'+b.lockRatio+'" class\x3d"cke_btn_locked" id\x3d"{lockButtonId}" role\x3d"checkbox"\x3e\x3cspan class\x3d"cke_icon"\x3e\x3c/span\x3e\x3cspan class\x3d"cke_label"\x3e'+b.lockRatio+'\x3c/span\x3e\x3c/a\x3e\x3ca href\x3d"javascript:void(0)" tabindex\x3d"-1" title\x3d"'+
b.resetSize+'" class\x3d"cke_btn_reset" id\x3d"{resetButtonId}" role\x3d"button"\x3e\x3cspan class\x3d"cke_label"\x3e'+b.resetSize+"\x3c/span\x3e\x3c/a\x3e\x3c/div\x3e")).output({lockButtonId:N,resetButtonId:O}),l=CKEDITOR.plugins.image3,D=k.config,F=!(!D.filebrowserImageBrowseUrl&&!D.filebrowserBrowseUrl),C=k.widgets.registered.image.features,J=l.getNatural,z,n,P,L,p,q,t,u,v,d,E,f,y,g,h,w,G,x=l.PERCENT,T=l.PIXEL,B=function(){return{height:q||u,width:p||t}},Q=[{id:"src",type:"text",label:e.url,onKeyup:K,
onChange:K,setup:function(a){this.setValue(a.data.src)},commit:function(a){a.setData("src",this.getValue())},validate:CKEDITOR.dialog.validate.notEmpty(b.urlMissing)}];F&&Q.push({type:"button",id:"browse",style:"display:inline-block;margin-top:14px;",align:"center",label:k.lang.common.browseServer,hidden:!0,filebrowser:"info:src"});return{title:b.title,minWidth:250,minHeight:100,onLoad:function(){z=this._.element.getDocument();L=R()},onShow:function(){n=this.widget;P=n.parts.image;v=E=d=!1;G=J(P);
t=p=G.width;u=q=G.height},contents:[{id:"info",label:b.infoTab,elements:[{type:"vbox",padding:0,children:[{type:"hbox",widths:["100%"],className:"cke_dialog_image_url",children:Q}]},{id:"alt",type:"text",label:b.alt,setup:function(a){this.setValue(a.data.alt)},commit:function(a){a.setData("alt",this.getValue())},validate:!0===k.config.image3_altRequired?CKEDITOR.dialog.validate.notEmpty(b.altMissing):null},{type:"hbox",widths:["100%"],requiredContent:C.dimension.requiredContent,children:[{type:"radio",
width:"45px",id:"sizeimageby",label:b.sizeImageBy,onChange:function(){var a=this.getValue(),b={width:g.getValue(),height:h.getValue()},b=l.convertDimensionsTo(n,b,a,B());g.setValue(b.width);h.setValue(b.height)},items:[[b.pixels,T],[b.percentage,x]],onLoad:function(){},setup:function(a){w=this;this.setValue(a.data.sizeImageBy)},commit:function(a){a.setData("sizeImageBy",this.getValue())}}]},{type:"hbox",widths:["25%","25%","50%"],requiredContent:C.dimension.requiredContent,children:[{type:"text",
width:"45px",id:"width",label:e.width,validate:H,onKeyUp:M,onLoad:function(){g=this},setup:function(a){this.setValue(a.data.width)},commit:function(a){a.setData("width",this.getValue())}},{type:"text",id:"height",width:"45px",label:e.height,validate:H,onKeyUp:M,onLoad:function(){h=this},setup:function(a){this.setValue(a.data.height)},commit:function(a){a.setData("height",this.getValue())}},{id:"lock",type:"html",style:"margin-top:18px;width:40px;height:20px;",onLoad:function(){function a(a){a.on("mouseover",
function(){this.addClass("cke_btn_over")},a);a.on("mouseout",function(){this.removeClass("cke_btn_over")},a)}var b=this.getDialog();f=z.getById(N);y=z.getById(O);f&&(b.addFocusable(f,4+F),f.on("click",function(a){r();a.data&&a.data.preventDefault()},this.getDialog()),a(f));y&&(b.addFocusable(y,5+F),y.on("click",function(a){var b=v?{height:u,width:t}:{height:q,width:p};w.getValue()==x&&(b=l.convertDimensionsTo(n,b,w.getValue(),B()));g.setValue(b.width);h.setValue(b.height);a.data&&a.data.preventDefault()},
this),a(y))},setup:function(a){r(a.data.lock)},commit:function(a){a.setData("lock",d)},html:S}]},{type:"hbox",id:"alignment",requiredContent:C.align.requiredContent,children:[{id:"align",type:"radio",items:[[e.alignNone,"none"],[e.alignLeft,"left"],[e.alignCenter,"center"],[e.alignRight,"right"]],label:e.align,setup:function(a){this.setValue(a.data.align)},commit:function(a){a.setData("align",this.getValue())}}]},{id:"hasCaption",type:"checkbox",label:b.captioned,requiredContent:C.caption.requiredContent,
setup:function(a){this.setValue(a.data.hasCaption)},commit:function(a){a.setData("hasCaption",this.getValue())}}]},{id:"Upload",hidden:!0,filebrowser:"uploadButton",label:b.uploadTab,elements:[{type:"file",id:"upload",label:b.btnUpload,style:"height:40px"},{type:"fileButton",id:"uploadButton",filebrowser:"info:src",label:b.btnUpload,"for":["Upload","upload"]}]}]}});